use once_cell::sync::Lazy;
use std::collections::HashMap;

const FONT_HEIGHT: usize = 6;
const GLYPH_SPACING: usize = 3;

type Glyph = [&'static str; FONT_HEIGHT];

static GLYPHS: Lazy<HashMap<char, Glyph>> = Lazy::new(|| {
    let mut map: HashMap<char, Glyph> = HashMap::new();
    map.insert(
        'A',
        [
            " █████╗ ",
            "██╔══██╗",
            "██║  ██║",
            "███████║",
            "██╔══██║",
            "╚═╝  ╚═╝",
        ],
    );
    map.insert(
        'B',
        [
            "██████╗",
            "██╔══██╗",
            "██████╔╝",
            "██╔══██╗",
            "██║  ██║",
            "██████╔╝",
        ],
    );
    map.insert(
        'C',
        [
            " ██████╗",
            "██╔════╝",
            "██║     ",
            "██║     ",
            "╚██████╗",
            " ╚═════╝",
        ],
    );
    map.insert(
        'D',
        [
            "██████╗ ",
            "██╔══██╗",
            "██║  ██║",
            "██║  ██║",
            "██║  ██║",
            "╚██████╔╝",
        ],
    );
    map.insert(
        'E',
        [
            "███████╗",
            "██╔════╝",
            "█████╗  ",
            "██╔══╝  ",
            "███████╗",
            "╚══════╝",
        ],
    );
    map.insert(
        'F',
        [
            "███████╗",
            "██╔════╝",
            "█████╗  ",
            "██╔══╝  ",
            "██║     ",
            "╚═╝     ",
        ],
    );
    map.insert(
        'G',
        [
            " ██████╗ ",
            "██╔════╝ ",
            "██║  ███╗",
            "██║   ██║",
            "╚██████╔╝",
            " ╚═════╝ ",
        ],
    );
    map.insert(
        'H',
        [
            "██╗  ██╗",
            "██║  ██║",
            "███████║",
            "██╔══██║",
            "██║  ██║",
            "╚═╝  ╚═╝",
        ],
    );
    map.insert(
        'I',
        [
            "██╗",
            "██║",
            "██║",
            "██║",
            "██║",
            "╚═╝"
        ],
    );
    map.insert(
        'J',
        [
            "     ██╗",
            "     ██║",
            "     ██║",
            "██   ██║",
            "╚█████╔╝",
            " ╚════╝ ",
        ],
    );
    map.insert(
        'K',
        [
            "██╗  ██╗",
            "██║ ██╔╝",
            "█████╔╝ ",
            "██╔═██╗ ",
            "██║  ██╗",
            "╚═╝  ╚═╝",
        ],
    );
    map.insert(
        'L',
        [
            "██╗     ",
            "██║     ",
            "██║     ",
            "██║     ",
            "██║     ",
            "███████╗",
        ],
    );
    map.insert(
        'M',
        [
            "███╗   ███╗",
            "████╗ ████║",
            "██╔████╔██║",
            "██║╚██╔╝██║",
            "██║ ╚═╝ ██║",
            "╚═╝     ╚═╝",
        ],
    );
    map.insert(
        'N',
        [
            "███╗   ██╗",
            "████╗  ██║",
            "██╔██╗ ██║",
            "██║╚██╗██║",
            "██║ ╚████║",
            "╚═╝  ╚═══╝",
        ],
    );
    map.insert(
        'O',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "██║   ██║",
            "██║   ██║",
            "██║   ██║",
            "╚██████╔╝",
        ],
    );
    map.insert(
        'P',
        [
            "██████╗ ",
            "██╔══██╗",
            "██████╔╝",
            "██╔═══╝ ",
            "██║     ",
            "╚═╝     ",
        ],
    );
    map.insert(
        'Q',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "██║   ██║",
            "██║ ▄ ██║",
            "╚██████╔╝",
            " ╚══▀▀═╝ ",
        ],
    );
    map.insert(
        'R',
        [
            "██████╗ ",
            "██╔══██╗",
            "██████╔╝",
            "██╔══██╗",
            "██║  ██║",
            "╚═╝  ╚═╝",
        ],
    );
    map.insert(
        'S',
        [
            " ██████╗",
            "██╔════╝",
            "╚█████╗ ",
            " ╚═══██╗",
            "██████╔╝",
            "╚═════╝ ",
        ],
    );
    map.insert(
        'T',
        [
            "████████╗",
            "╚══██╔══╝",
            "   ██║   ",
            "   ██║   ",
            "   ██║   ",
            "   ╚═╝   ",
        ],
    );
    map.insert(
        'U',
        [
            "██╗   ██╗",
            "██║   ██║",
            "██║   ██║",
            "██║   ██║",
            "╚██╗ ██╔╝",
            " ╚████╔╝ ",
        ],
    );
    map.insert(
        'V',
        [
            "██╗   ██╗",
            "██║   ██║",
            "██║   ██║",
            "╚██╗ ██╔╝",
            " ╚████╔╝ ",
            "  ╚═══╝  ",
        ],
    );
    map.insert(
        'W',
        [
            "██╗    ██╗",
            "██║    ██║",
            "██║ █╗ ██║",
            "██║███╗██║",
            "╚███╔███╔╝",
            " ╚══╝╚══╝ ",
        ],
    );
    map.insert(
        'X',
        [
            "██╗  ██╗",
            "╚██╗██╔╝",
            " ╚███╔╝ ",
            " ██╔██╗ ",
            "██╔╝╚██╗",
            "╚═╝  ╚═╝",
        ],
    );
    map.insert(
        'Y',
        [
            "██╗   ██╗",
            "╚██╗ ██╔╝",
            " ╚████╔╝ ",
            "  ╚██╔╝  ",
            "   ██║   ",
            "   ╚═╝   ",
        ],
    );
    map.insert(
        'Z',
        [
            "███████╗",
            "╚══███╔╝",
            "  ███╔╝ ",
            " ███╔╝  ",
            "███╔╝   ",
            "███████╗",
        ],
    );
    map.insert(
        '0',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "██║   ██║",
            "██║   ██║",
            "██║   ██║",
            "╚██████╔╝",
        ],
    );
    map.insert(
        '1',
        [
            "   ██╗",
            "  ███║",
            "  ╚██║",
            "   ██║",
            "   ██║",
            "   ╚═╝",
        ],
    );
    map.insert(
        '2',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "╚════██╔╝",
            " █████╔╝ ",
            "██╔═══╝  ",
            "███████╗ ",
        ],
    );
    map.insert(
        '3',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "╚════██╔╝",
            " ██████╔╝",
            " ╚═══██║ ",
            " █████╔╝ ",
        ],
    );
    map.insert(
        '4',
        [
            "██╗  ██╗",
            "██║  ██║",
            "███████║",
            "╚════██║",
            "     ██║",
            "     ╚═╝",
        ],
    );
    map.insert(
        '5',
        [
            "███████╗",
            "██╔════╝",
            "██████╗ ",
            "╚════██╗",
            "██████╔╝",
            "╚═════╝ ",
        ],
    );
    map.insert(
        '6',
        [
            " ██████╗ ",
            "██╔════╝ ",
            "██████╗  ",
            "██╔══██╗ ",
            "██║  ██║ ",
            "╚██████╔╝",
        ],
    );
    map.insert(
        '7',
        [
            "███████╗",
            "╚═══██╔╝",
            "   ██╔╝ ",
            "  ██╔╝  ",
            " ██╔╝   ",
            " ╚═╝    ",
        ],
    );
    map.insert(
        '8',
        [
            " █████╗ ",
            "██╔══██╗",
            "╚█████╔╝",
            "██╔══██╗",
            "╚█████╔╝",
            " ╚════╝ ",
        ],
    );
    map.insert(
        '9',
        [
            " ██████╗",
            "██╔══██╗",
            "██║  ██║",
            "╚██████║",
            " ╚═══██║",
            " █████╔╝",
        ],
    );
    map.insert(
        '-',
        [
            "        ",
            "        ",
            "███████╗",
            "╚══════╝",
            "        ",
            "        ",
        ],
    );
    map.insert(
        '/',
        [
            "     ██╗",
            "    ██╔╝",
            "   ██╔╝ ",
            "  ██╔╝  ",
            " ██╔╝   ",
            " ╚═╝    ",
        ],
    );
    map.insert(
        ':',
        [
            "    ",
            " ██╗",
            " ╚═╝",
            " ██╗",
            " ╚═╝",
            "    ",
        ],
    );
    map.insert(' ', ["    ", "    ", "    ", "    ", "    ", "    "]);
    map.insert(
        '?',
        [
            " ██████╗ ",
            "██╔═══██╗",
            "╚════██╔╝",
            "    ██╔╝ ",
            "    ╚═╝  ",
            "    ██╗  ",
        ],
    );
    map
});

/// Render the provided text using the stylised banner font.
pub fn render(text: &str) -> Vec<String> {
    let content: Vec<char> = text.chars().map(|c| c.to_ascii_uppercase()).collect();
    if content.is_empty() {
        return vec![String::new(); FONT_HEIGHT];
    }

    let fallback = GLYPHS.get(&'?').expect("fallback glyph missing");
    let mut rows = vec![String::new(); FONT_HEIGHT];

    for (index, ch) in content.iter().enumerate() {
        let glyph = GLYPHS.get(ch).unwrap_or(fallback);
        let glyph_width = glyph
            .iter()
            .map(|line| line.chars().count())
            .max()
            .unwrap_or(0);

        for (row_idx, segment) in glyph.iter().enumerate() {
            rows[row_idx].push_str(segment);
            let pad = glyph_width.saturating_sub(segment.chars().count());
            if pad > 0 {
                rows[row_idx].extend(std::iter::repeat(' ').take(pad));
            }
            if index < content.len() - 1 {
                rows[row_idx]
                    .extend(std::iter::repeat(' ').take(GLYPH_SPACING));
            }
        }
    }

    rows
}
